1
00:00:00,314 --> 00:00:01,794
哈喽小伙伴大家好

2
00:00:01,794 --> 00:00:03,274
这节课我们来学习

3
00:00:03,274 --> 00:00:05,754
Rookieper里边的一个选举机制

4
00:00:05,754 --> 00:00:07,674
我们都知道Rookieper

5
00:00:07,874 --> 00:00:10,354
它并不是采用我们之前所学习过的

6
00:00:10,354 --> 00:00:13,194
NGX或者是我们的Redis里边的

7
00:00:13,234 --> 00:00:14,554
主备的这种方式

8
00:00:14,554 --> 00:00:17,074
也就是说Master和Slave的这种方式

9
00:00:17,074 --> 00:00:18,994
而是采用了一种叫做

10
00:00:18,994 --> 00:00:20,954
Leader和Follower的这种方式

11
00:00:20,954 --> 00:00:24,314
就是领导者和随从者的这种方式

12
00:00:24,314 --> 00:00:25,194
但是我们这节课

13
00:00:25,194 --> 00:00:28,074
我们主要讲的是一个选举机制

14
00:00:28,074 --> 00:00:30,634
那说假如说我们有一个Rookieper的

15
00:00:30,634 --> 00:00:32,514
一个集群里边有一台机器

16
00:00:32,514 --> 00:00:32,954
两台机器

17
00:00:32,954 --> 00:00:33,394
三台机器

18
00:00:33,394 --> 00:00:33,794
四台机器

19
00:00:33,794 --> 00:00:34,514
五台机器

20
00:00:34,514 --> 00:00:36,274
为什么第三台机器

21
00:00:36,274 --> 00:00:37,514
它就是领导者

22
00:00:37,514 --> 00:00:39,154
别人就是一个随从者

23
00:00:39,394 --> 00:00:41,034
这就是我们这节课的一个重点

24
00:00:41,234 --> 00:00:42,594
就是说选举机制

25
00:00:42,594 --> 00:00:44,474
到底是怎么选出来的

26
00:00:44,514 --> 00:00:47,194
它有点像我们在之前所上学的时候

27
00:00:47,194 --> 00:00:48,474
因为我们之前所上学的时候

28
00:00:48,554 --> 00:00:49,834
是不是班里面都有班长

29
00:00:49,994 --> 00:00:51,314
这个班长怎么出来的

30
00:00:51,594 --> 00:00:53,354
都是我们通过同学之间

31
00:00:53,354 --> 00:00:54,794
是不是选举出来的

32
00:00:54,994 --> 00:00:57,434
票数多的则当选班长

33
00:00:57,434 --> 00:01:00,474
但是在Rookieper集群中也是一样的

34
00:01:00,794 --> 00:01:04,474
票数多的则你可以当选领导者

35
00:01:04,474 --> 00:01:06,234
我们来具体看一下

36
00:01:06,234 --> 00:01:07,634
我们Rookieper里边的

37
00:01:07,634 --> 00:01:09,566
核心选举的一个原则

38
00:01:10,426 --> 00:01:14,426
在这个Rookieboard集群中只有超过半数以上的服务器启动

39
00:01:14,426 --> 00:01:17,386
我们这个Rookieboard的集群才能正常工作

40
00:01:17,386 --> 00:01:18,266
什么意思呢

41
00:01:18,266 --> 00:01:19,826
比如说我们有个Rookieboard的集群

42
00:01:19,826 --> 00:01:21,346
我们有五台机器

43
00:01:21,346 --> 00:01:22,706
你要超过半数

44
00:01:22,706 --> 00:01:25,666
是不是三台机器就可以什么呢

45
00:01:25,666 --> 00:01:27,906
正常的启动我们这个Rookieboard的一个集群了

46
00:01:27,906 --> 00:01:30,306
那比如说你只起来两台

47
00:01:30,306 --> 00:01:31,986
两台超过半数的吗

48
00:01:31,986 --> 00:01:33,066
并没有是不是

49
00:01:33,066 --> 00:01:36,826
那如果说你五台Rookieboard里边只起来两台机器

50
00:01:36,826 --> 00:01:39,306
那则代表的是你这个Rookieboard它并没有正常运行

51
00:01:39,306 --> 00:01:40,026
明白没有

52
00:01:40,026 --> 00:01:42,746
那第二个在这个集群

53
00:01:42,746 --> 00:01:45,146
也说在集群正常工作之前

54
00:01:45,146 --> 00:01:49,306
比如说myid小的服务器会给myid大的服务器

55
00:01:50,042 --> 00:01:54,242
那你说我们一说到投票就相当于是在我们大学里边

56
00:01:54,242 --> 00:01:56,942
上学的时候某某都投票给班长是吧

57
00:01:56,942 --> 00:01:58,742
我就喜欢那个小伙他当班长

58
00:01:58,742 --> 00:02:00,478
那在乳配分中也是一样的

59
00:02:01,050 --> 00:02:02,570
他投票是什么呢

60
00:02:02,570 --> 00:02:06,490
让小的ID给大的投票是这样的这种方式

61
00:02:06,490 --> 00:02:08,730
我们一会来做一个详细的讲解

62
00:02:08,730 --> 00:02:11,570
第三个是半数机制

63
00:02:11,570 --> 00:02:14,090
就是超过半数你就当选

64
00:02:14,090 --> 00:02:16,810
你就当选了这个later了

65
00:02:16,810 --> 00:02:18,210
当选了这个领导者了

66
00:02:18,210 --> 00:02:19,810
我们来具体看一下

67
00:02:19,810 --> 00:02:22,330
这个选举机制的一个流程

68
00:02:22,330 --> 00:02:25,250
比如说我们有一个Rookieper的集群

69
00:02:25,250 --> 00:02:26,210
在Rookieper集群中

70
00:02:26,210 --> 00:02:27,050
我们有一台机器

71
00:02:27,050 --> 00:02:27,490
两台机器

72
00:02:27,490 --> 00:02:27,930
三台机器

73
00:02:27,930 --> 00:02:28,410
四台机器

74
00:02:28,410 --> 00:02:28,542
五台机器

75
00:02:29,434 --> 00:02:31,674
有如RuGabber的集群

76
00:02:31,674 --> 00:02:32,762
< No Speech >

77
00:02:32,762 --> 00:02:35,070
当然我们在之前我们所学习

78
00:02:35,706 --> 00:02:39,486
我们所学习这个搭建这个Rookkeeper机器的时候呢

79
00:02:39,486 --> 00:02:40,726
我们在这个配置文件中

80
00:02:40,726 --> 00:02:45,046
大家注意我们是不是弄了一个叫做server123

81
00:02:45,046 --> 00:02:47,406
是不是那如果说我们有5台机的时候

82
00:02:47,406 --> 00:02:49,686
那你这是不是要写12345是不是

83
00:02:49,686 --> 00:02:51,806
并且呢我们后边跟了一个IP地址

84
00:02:51,806 --> 00:02:52,798
后边呢还跟了一个

85
00:02:52,798 --> 00:02:53,818
< No Speech >

86
00:02:53,818 --> 00:02:55,550
以及三把断扣

87
00:02:55,550 --> 00:02:56,570
< No Speech >

88
00:02:56,570 --> 00:02:58,130
为什么有个2888

89
00:02:58,130 --> 00:02:59,730
为什么还有个3888

90
00:03:00,050 --> 00:03:01,210
它的作用是什么

91
00:03:01,370 --> 00:03:02,530
OK我们来看一下

92
00:03:02,530 --> 00:03:04,190
比如说我们

93
00:03:04,730 --> 00:03:06,942
这块第一台机器它起来了

94
00:03:06,942 --> 00:03:08,154
< No Speech >

95
00:03:08,154 --> 00:03:10,046
它首先要做的第一件事

96
00:03:11,002 --> 00:03:15,722
388端口就是3883888这个端口

97
00:03:15,722 --> 00:03:16,842
有没有人用

98
00:03:16,842 --> 00:03:18,562
如果这个端口有人用了

99
00:03:18,562 --> 00:03:19,522
则说明什么

100
00:03:20,202 --> 00:03:21,522
已经有人当领导了

101
00:03:21,522 --> 00:03:24,162
说白了就是这个机器它起来之后

102
00:03:24,442 --> 00:03:26,442
去388这个端口里边看看

103
00:03:26,642 --> 00:03:27,162
有没有人用

104
00:03:27,522 --> 00:03:28,242
如果有人用

105
00:03:28,242 --> 00:03:30,558
就代表的是领导者已经有了

106
00:03:30,558 --> 00:03:33,594
< No Speech >

107
00:03:33,594 --> 00:03:35,534
然后如果说你没有

108
00:03:35,554 --> 00:03:37,694
然后他起来之后他发现

109
00:03:37,694 --> 00:03:39,614
3888转口里边没人用

110
00:03:40,346 --> 00:03:41,346
他就要干嘛

111
00:03:41,706 --> 00:03:43,186
他就要投自己一票

112
00:03:43,186 --> 00:03:45,186
在2888端口里边

113
00:03:45,226 --> 00:03:46,506
他就投了自己一票

114
00:03:46,506 --> 00:03:47,998
哎呀没有人当两大呀

115
00:03:47,998 --> 00:03:50,106
< No Speech >

116
00:03:50,106 --> 00:03:51,226
这是第一台机器

117
00:03:51,226 --> 00:03:53,026
那第二台机器起来之后

118
00:03:53,026 --> 00:03:53,506
记住

119
00:03:53,506 --> 00:03:54,666
第二台机器起来之后

120
00:03:55,418 --> 00:03:57,218
干的第一件事也是一样

121
00:03:57,218 --> 00:03:58,778
在388端口里边

122
00:03:58,778 --> 00:04:00,498
3888的端口里边

123
00:04:00,498 --> 00:04:02,714
< No Speech >

124
00:04:02,714 --> 00:04:04,394
哎呀没有人是两岛是吧

125
00:04:04,394 --> 00:04:05,394
明儿是两岛之后

126
00:04:05,394 --> 00:04:07,866
< No Speech >

127
00:04:07,866 --> 00:04:10,546
第二台机器它是野投给自己一票

128
00:04:10,546 --> 00:04:12,606
那第一台机器也投给自己一票

129
00:04:12,606 --> 00:04:13,754
< No Speech >

130
00:04:13,754 --> 00:04:18,434
然后呢我们说ID小的给ID大的会投票

131
00:04:18,434 --> 00:04:20,354
我们就说礼让的原则

132
00:04:20,354 --> 00:04:21,154
什么意思呢

133
00:04:21,154 --> 00:04:23,314
有点像恐龙让礼啊

134
00:04:23,314 --> 00:04:25,154
就说他呢自然知道

135
00:04:25,154 --> 00:04:27,354
哦原来我又有一个伙伴来了

136
00:04:27,354 --> 00:04:27,874
是不是

137
00:04:27,874 --> 00:04:29,594
然后呢我要礼让什么意思呢

138
00:04:29,594 --> 00:04:31,794
我要投他一票

139
00:04:31,794 --> 00:04:33,994
就是有一个伙伴进来了啊

140
00:04:33,994 --> 00:04:35,230
他就当投别人一票

141
00:04:35,230 --> 00:04:38,522
< No Speech >

142
00:04:38,522 --> 00:04:39,322
记住没有

143
00:04:39,322 --> 00:04:41,482
就是恐龙让利的这种方式

144
00:04:41,762 --> 00:04:42,322
有人来了

145
00:04:42,322 --> 00:04:43,422
我就投你一票

146
00:04:44,250 --> 00:04:45,810
这个是一票 这个是两票

147
00:04:45,810 --> 00:04:46,930
两票当选吗

148
00:04:46,930 --> 00:04:47,490
不当选

149
00:04:47,490 --> 00:04:48,370
我们来看一下

150
00:04:48,370 --> 00:04:49,810
这个Rookie本人集权有几个

151
00:04:49,810 --> 00:04:50,302
有五盒

152
00:04:50,810 --> 00:04:52,570
舞台我们要超过半数

153
00:04:52,570 --> 00:04:55,210
必须要保证三台三票

154
00:04:55,250 --> 00:04:56,730
是不是保证了三票

155
00:04:56,730 --> 00:04:57,490
你就能干嘛

156
00:04:57,690 --> 00:04:58,730
当选雷德

157
00:04:58,730 --> 00:05:00,290
然后我们再来看第3台

158
00:05:00,610 --> 00:05:01,450
第3台起来之后

159
00:05:01,570 --> 00:05:02,610
他所要干的第一件事

160
00:05:02,610 --> 00:05:03,290
有没有人当领导

161
00:05:03,490 --> 00:05:04,290
没有人当领导

162
00:05:04,290 --> 00:05:05,130
没有人当领导

163
00:05:05,130 --> 00:05:06,210
我当领导

164
00:05:06,210 --> 00:05:07,902
然后他给自己投一票

165
00:05:08,794 --> 00:05:11,794
这两个哥们他发现又有个小伙伴来了

166
00:05:11,794 --> 00:05:13,790
我们这两个也要投他一票

167
00:05:13,790 --> 00:05:15,226
< No Speech >

168
00:05:15,226 --> 00:05:16,666
这个投他一票

169
00:05:16,666 --> 00:05:18,226
这个也投他一票

170
00:05:18,226 --> 00:05:19,518
那这个时候大家注意

171
00:05:20,378 --> 00:05:21,498
他就有什么呢

172
00:05:21,498 --> 00:05:22,258
三票

173
00:05:22,418 --> 00:05:23,978
然后三票之后

174
00:05:23,978 --> 00:05:26,622
我们会发现整个乳K伯的集群

175
00:05:26,622 --> 00:05:28,250
< No Speech >

176
00:05:28,250 --> 00:05:30,490
5台机器超过半数

177
00:05:30,490 --> 00:05:31,902
三票就登选

178
00:05:31,902 --> 00:05:33,498
< No Speech >

179
00:05:33,498 --> 00:05:35,098
它就会变成later

180
00:05:35,098 --> 00:05:36,510
这就是我们所说的

181
00:05:37,498 --> 00:05:39,418
他的一个选举机制

182
00:05:39,458 --> 00:05:42,538
然后第4台和第5台起来之后

183
00:05:43,058 --> 00:05:44,938
他在388端口里边看一下

184
00:05:44,938 --> 00:05:45,938
有没有人等两岛

185
00:05:45,938 --> 00:05:48,894
有有则自己就变成了

186
00:05:49,722 --> 00:05:51,646
呢就系入Kper里边嘅

187
00:05:51,646 --> 00:05:52,698
< No Speech >

188
00:05:52,698 --> 00:05:56,574
选举机制并且系半数机制

189
00:05:57,114 --> 00:05:58,594
半数机制的意思就是

190
00:05:58,594 --> 00:06:00,834
你超过半数就可以当选lader

191
00:06:00,834 --> 00:06:04,286
所以说我们在选择rootkeeper集群的时候

192
00:06:04,286 --> 00:06:05,370
< No Speech >

193
00:06:05,370 --> 00:06:07,690
你最好搭建这个数量的时候

194
00:06:07,690 --> 00:06:10,714
< No Speech >

195
00:06:10,714 --> 00:06:12,734
舞台机器三票登选

196
00:06:12,734 --> 00:06:14,746
< No Speech >

197
00:06:14,746 --> 00:06:17,146
那九台机器7票当选

198
00:06:17,146 --> 00:06:18,306
所以说呢我们记住

199
00:06:18,306 --> 00:06:19,866
所以说基数特别好选

200
00:06:19,866 --> 00:06:21,466
那如果说你有四台机器

201
00:06:21,466 --> 00:06:25,386
你怎么能得到那种半超过半数的这个数量呢

202
00:06:25,386 --> 00:06:26,706
不太好算是不是

203
00:06:26,706 --> 00:06:27,966
所以说呢我们记住啊

204
00:06:28,890 --> 00:06:31,690
RuKber里边没有任何数据的时候

205
00:06:31,690 --> 00:06:34,930
我们它就采用了这种方式进行选举的

206
00:06:34,930 --> 00:06:36,610
当然了如果说我们有了以后

207
00:06:36,930 --> 00:06:38,330
也不可能用这种方式了

208
00:06:38,330 --> 00:06:38,846
那是不是这样呢

209
00:06:38,846 --> 00:06:40,442
< No Speech >

210
00:06:40,442 --> 00:06:42,882
在RuKer中还有一些相关的概念

211
00:06:42,882 --> 00:06:44,682
比如说第一个服务器的ID

212
00:06:44,682 --> 00:06:47,402
这个服务器的ID就是我们所刚刚所说的

213
00:06:47,402 --> 00:06:49,482
myID里面的编号123

214
00:06:49,482 --> 00:06:53,042
就是说这个数量就是这个ID的数越大

215
00:06:53,042 --> 00:06:54,082
权重越大

216
00:06:54,082 --> 00:06:55,242
就是你的数越大

217
00:06:55,242 --> 00:06:58,122
你被选为Lady的几率

218
00:06:58,122 --> 00:06:58,302
然后你给他的这个几率会更大

219
00:06:59,066 --> 00:07:02,974
第二个是这个ZXID就是数据ID

220
00:07:03,770 --> 00:07:07,410
服务器中存放的最大的数据ID

221
00:07:07,410 --> 00:07:09,290
就是谁的电脑里边

222
00:07:09,290 --> 00:07:11,250
就是谁的机器里边

223
00:07:11,250 --> 00:07:12,050
是哪台机器里面

224
00:07:12,050 --> 00:07:16,730
谁的ZXID这个数量大

225
00:07:16,730 --> 00:07:18,290
谁就可以当选later

226
00:07:18,290 --> 00:07:18,610
为什么

227
00:07:18,930 --> 00:07:19,330
因为什么

228
00:07:19,410 --> 00:07:23,290
因为你ZXID则代表的是你的数据月薪

229
00:07:23,690 --> 00:07:24,410
你值越大

230
00:07:24,410 --> 00:07:25,170
你数据越新

231
00:07:25,170 --> 00:07:26,130
你数据越新

232
00:07:26,130 --> 00:07:28,650
则代表的是你越有可能当领导

233
00:07:28,650 --> 00:07:31,170
因为你的电脑里边的数据是最新的

234
00:07:31,170 --> 00:07:32,990
你就可以把你的数据同步给

235
00:07:33,658 --> 00:07:35,658
同步给你别的一些小弟了

236
00:07:35,658 --> 00:07:38,218
最后一个是一个逻辑桩

237
00:07:38,218 --> 00:07:40,190
那这个逻辑桩呢 我们可以把它叫做什么呢

238
00:07:40,190 --> 00:07:41,402
< No Speech >

239
00:07:41,402 --> 00:07:43,122
就是同一轮投票过程中

240
00:07:43,122 --> 00:07:44,602
我们这个逻辑时钟呢

241
00:07:44,602 --> 00:07:45,242
这个值啊

242
00:07:45,242 --> 00:07:46,402
记住是相同的

243
00:07:46,402 --> 00:07:47,922
那每投完一次这个值呢

244
00:07:47,922 --> 00:07:48,842
它就会增加

245
00:07:48,842 --> 00:07:49,402
然后呢

246
00:07:49,402 --> 00:07:52,682
我们还会根据其他服务器返回的投票信息呢

247
00:07:52,682 --> 00:07:53,602
做一些对比啊

248
00:07:53,602 --> 00:07:54,122
然后呢

249
00:07:54,122 --> 00:07:56,802
我们可以根据不同的值去做一些不同的判断

250
00:07:56,802 --> 00:07:59,002
我们说的下边的这些概念呢

251
00:07:59,002 --> 00:08:01,242
也是可以影响他这个

252
00:08:01,242 --> 00:08:01,602
嗯

253
00:08:01,602 --> 00:08:03,282
选举机的一个过程啊

254
00:08:03,282 --> 00:08:04,362
比如说ID呀

255
00:08:04,362 --> 00:08:04,842
是吧

256
00:08:04,842 --> 00:08:07,682
选举的这个这个数据的ID啊

257
00:08:07,682 --> 00:08:09,482
以及逻辑时钟等等等等啊

258
00:08:09,482 --> 00:08:10,082
等等等等

259
00:08:10,082 --> 00:08:10,802
所以说呢

260
00:08:10,802 --> 00:08:12,082
我们这个选举机制呢

261
00:08:12,082 --> 00:08:13,322
是最开始的时候呢

262
00:08:13,322 --> 00:08:14,402
里边没有数据啊

263
00:08:14,402 --> 00:08:15,562
则是这种机制

264
00:08:15,562 --> 00:08:17,282
那如果说有数据了啊

265
00:08:17,282 --> 00:08:20,402
基本上就是按我们下面的这些概念去走的啊

266
00:08:20,402 --> 00:08:21,882
按下面这个概念去走的

267
00:08:21,882 --> 00:08:22,442
那以上呢

268
00:08:22,442 --> 00:08:26,402
就是我们整个RuKaper的一个选举机制的全部内容

269
00:08:26,402 --> 00:08:27,082
所以说呢

270
00:08:27,082 --> 00:08:27,322
呃

271
00:08:27,322 --> 00:08:28,802
我们为什么要讲这些课呢

272
00:08:28,802 --> 00:08:29,562
说到底啊

273
00:08:29,562 --> 00:08:30,682
就是想让小伙伴呢

274
00:08:30,682 --> 00:08:33,882
明白我们在搭建这个RuKaper集群的时候呢

275
00:08:33,882 --> 00:08:35,402
记住一点就可以了

276
00:08:35,402 --> 00:08:38,362
就是RuKaper的数量一定要为基数

277
00:08:38,362 --> 00:08:39,482
因为这样的时候呢

278
00:08:39,482 --> 00:08:40,442
他在进行什么呢

279
00:08:40,442 --> 00:08:42,162
选举这个Ladder的时候呢

280
00:08:42,162 --> 00:08:45,602
比较快速的可以选举出来最新的一个领导者

281
00:08:45,602 --> 00:08:46,722
OK那以上呢

282
00:08:46,722 --> 00:08:47,710
就是我们全部

283
00:08:47,710 --> 00:08:49,178
< No Speech >

284
00:08:49,178 --> 00:08:50,898
选举机制的全部内容了

285
00:08:50,898 --> 00:08:51,818
我们在结束之前

286
00:08:51,818 --> 00:08:53,374
我们再做两个链一题

287
00:08:54,266 --> 00:08:55,926
在这个Rupert计划中

288
00:08:55,926 --> 00:08:57,374
他的这个选举机制

289
00:08:57,374 --> 00:08:58,778
< No Speech >

290
00:08:58,778 --> 00:09:01,374
第一半数 轮循 最小连接最小响应

291
00:09:01,374 --> 00:09:03,066
< No Speech >

292
00:09:03,066 --> 00:09:04,666
半数机制是不是

293
00:09:04,666 --> 00:09:06,866
那第二个呢在这个rootkeeper的技术中

294
00:09:06,866 --> 00:09:08,706
我们这个rootkeeper的服务器的数量

295
00:09:08,706 --> 00:09:10,466
记住最好设置为什么

296
00:09:10,466 --> 00:09:11,706
第一个基数

297
00:09:11,706 --> 00:09:13,106
第二个偶数

298
00:09:13,106 --> 00:09:14,426
第三个随意

299
00:09:14,426 --> 00:09:16,466
随时呢我们要采用的是基数

300
00:09:16,466 --> 00:09:18,186
因为我们要超过半数嘛

301
00:09:18,186 --> 00:09:20,306
随时呢我们要采用基数的这种方式

302
00:09:20,306 --> 00:09:23,266
进行rootkeeper服务器集群的一个部署

303
00:09:23,266 --> 00:09:23,786
好了

304
00:09:23,786 --> 00:09:26,946
以上呢就是我们全部这个选举机制的一个内容了

305
00:09:26,946 --> 00:09:28,446
到这呢就结束了

