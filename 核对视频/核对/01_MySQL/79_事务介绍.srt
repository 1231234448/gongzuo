1
00:00:00,858 --> 00:00:05,258
这节课我们再来讲解一下MySQL当中的事物

2
00:00:05,258 --> 00:00:10,458
那么事物其实在官型数据库当中它是非常重要的一个概念

3
00:00:10,458 --> 00:00:13,258
不仅仅是MySQL当中支持的事物

4
00:00:13,258 --> 00:00:16,378
所有的官型数据库都支持事物

5
00:00:16,378 --> 00:00:19,898
那么到底什么是事物呢?我们来看一下事物简介

6
00:00:19,898 --> 00:00:26,538
事物它是指作为单个逻辑工作单元执行的一系列操作

7
00:00:26,538 --> 00:00:29,658
要么完全的执行,要么完全的不执行

8
00:00:29,658 --> 00:00:32,858
同学们注意在这段话当中最后这一句

9
00:00:32,858 --> 00:00:36,058
要么完全的执行,要么完全的不执行

10
00:00:36,826 --> 00:00:41,826
对不对?那么其实我们通过这句话的分析也能够理解到

11
00:00:41,826 --> 00:00:47,586
所谓的事物其实就是为了保证在对数据库当中的数据做操作时

12
00:00:47,586 --> 00:00:49,826
保证它的一个可靠性的问题

13
00:00:49,826 --> 00:00:51,826
对吧?举个例子啊

14
00:00:52,794 --> 00:00:56,714
比如说现在我们开发的系统是网上银行的这样的一个系统

15
00:00:56,714 --> 00:00:59,634
那么网上银行肯定是支持账户转账

16
00:00:59,634 --> 00:01:01,794
账户之间相互转账的这样的业务处理了

17
00:01:01,794 --> 00:01:02,354
对吧

18
00:01:02,354 --> 00:01:04,794
比如说我现在有一个A账户

19
00:01:04,794 --> 00:01:05,994
我有一个B账户

20
00:01:05,994 --> 00:01:09,674
我要从A账户里给B账户转100块钱

21
00:01:10,274 --> 00:01:11,794
那么对于这样的一个业务

22
00:01:11,794 --> 00:01:13,674
这是在我们系统当中称之为业务

23
00:01:13,674 --> 00:01:14,074
对吧

24
00:01:14,074 --> 00:01:15,474
那么对于这样的一个业务

25
00:01:15,474 --> 00:01:17,794
我要对数据库进行哪些操作呢

26
00:01:17,794 --> 00:01:18,714
大家想一下

27
00:01:19,234 --> 00:01:22,074
我对这个数据库是不是要进行一些这样的操作

28
00:01:22,074 --> 00:01:25,314
首先第1个我们要先去查A B两个账户存不存在

29
00:01:26,074 --> 00:01:26,434
对吧

30
00:01:26,434 --> 00:01:29,994
我要想A账户向B账户转账

31
00:01:29,994 --> 00:01:32,074
我必须得保证两个账户是存在的

32
00:01:32,474 --> 00:01:32,834
对吧

33
00:01:32,834 --> 00:01:37,434
然后其次是判断A账户里的余额是否大于等于100

34
00:01:37,794 --> 00:01:39,074
因为A要给B转账

35
00:01:39,594 --> 00:01:41,874
如果A的余额都不够100块钱

36
00:01:41,874 --> 00:01:42,874
我怎么给你转呢

37
00:01:42,874 --> 00:01:43,274
是吧

38
00:01:43,274 --> 00:01:46,314
所以必须要判断A的账户余额是否大于等于100

39
00:01:46,594 --> 00:01:47,834
那么如果没有问题

40
00:01:47,834 --> 00:01:49,874
它的余额是大于等于100的了

41
00:01:49,874 --> 00:01:51,474
接下来是不是就要转账了

42
00:01:51,474 --> 00:01:53,034
那么所谓的转账

43
00:01:53,034 --> 00:01:57,434
在我们对数据库当中所要进行的操作是什么样的操作

44
00:01:57,434 --> 00:01:59,594
是不是就是两条update语句

45
00:01:59,594 --> 00:02:00,314
同学们

46
00:02:00,314 --> 00:02:01,354
第1条

47
00:02:02,234 --> 00:02:05,314
先把A账户余额扣除100

48
00:02:05,834 --> 00:02:08,394
然后再给B账户余额

49
00:02:08,394 --> 00:02:11,234
再给A的账户余额扣除100

50
00:02:11,234 --> 00:02:13,474
给B的账户余额再加100

51
00:02:13,874 --> 00:02:14,754
一个是减100

52
00:02:14,754 --> 00:02:15,594
一个是加100

53
00:02:15,594 --> 00:02:17,354
这不就两个update语句吗

54
00:02:17,674 --> 00:02:18,234
对吧

55
00:02:18,234 --> 00:02:21,634
那么我们数据库在执行这样操作时

56
00:02:21,634 --> 00:02:24,994
就需要保证查询无所谓

57
00:02:24,994 --> 00:02:27,954
就要保证这两个update语句

58
00:02:27,954 --> 00:02:28,874
要么都成功

59
00:02:28,874 --> 00:02:29,714
要么都失败

60
00:02:30,474 --> 00:02:32,154
如果做不到这一点

61
00:02:32,154 --> 00:02:33,194
它就会出现问题

62
00:02:33,194 --> 00:02:33,754
什么问题呢

63
00:02:33,754 --> 00:02:34,274
大家想

64
00:02:34,274 --> 00:02:37,634
比如说A给账户再给B转钱时

65
00:02:37,634 --> 00:02:39,514
A减100成功了

66
00:02:39,954 --> 00:02:41,954
那么B再加100时

67
00:02:41,954 --> 00:02:45,314
因为一些其他的因素导致这个语句执行失败了

68
00:02:45,314 --> 00:02:45,662
因为要判断C和B账户资料

69
00:02:46,202 --> 00:02:51,002
那么这个时候对于A减100这个事儿是不是即便你成功了也应该撤销啊

70
00:02:51,002 --> 00:02:53,122
如果不撤销那说明什么

71
00:02:53,122 --> 00:02:54,922
A给B转钱

72
00:02:54,922 --> 00:02:56,202
A的钱被扣掉了

73
00:02:56,202 --> 00:02:59,202
B的账户里钱还没转进来丢了100块钱呢

74
00:02:59,202 --> 00:03:00,250
< No Speech >

75
00:03:00,250 --> 00:03:04,250
是不是同学们 或者是什么 还有这种情况

76
00:03:04,250 --> 00:03:10,206
A账户减100是失败了 然后下面B加100是成功了

77
00:03:11,130 --> 00:03:12,930
那相当于B多了100块钱

78
00:03:12,930 --> 00:03:14,290
A的账户减钱失败了吗

79
00:03:14,290 --> 00:03:14,850
那就没减

80
00:03:14,850 --> 00:03:16,650
那这100块钱到底谁出

81
00:03:16,650 --> 00:03:18,210
是吧同学们

82
00:03:18,210 --> 00:03:22,450
所以我为了保证业务的完整性

83
00:03:22,450 --> 00:03:25,250
或者叫业务的逻辑是正确的

84
00:03:25,250 --> 00:03:26,970
那么你数据库必须要保证

85
00:03:26,970 --> 00:03:28,650
对于这两个更新语句而言

86
00:03:28,650 --> 00:03:29,690
要么完全的执行

87
00:03:29,690 --> 00:03:30,890
要么完全的不执行

88
00:03:30,890 --> 00:03:31,770
依赖于什么

89
00:03:31,770 --> 00:03:34,570
就是依赖数据库当中的事物来实现的

90
00:03:34,570 --> 00:03:35,570
这就是事物

91
00:03:35,570 --> 00:03:37,530
这叫事物控制

92
00:03:37,530 --> 00:03:38,010
能明白吗

93
00:03:38,010 --> 00:03:38,530
同学们

94
00:03:38,530 --> 00:03:39,038
是

95
00:03:39,674 --> 00:03:44,314
好 我们再来看一下事物定义 事物我们称之为transaction

96
00:03:44,314 --> 00:03:47,914
事物它是一个最小的不可再分割的工作单元

97
00:03:47,914 --> 00:03:50,354
通常一个事物对应一个完整的业务

98
00:03:50,354 --> 00:03:52,274
我们刚刚举的例子已经说得很清楚了

99
00:03:52,274 --> 00:03:56,794
我们转账的这个业务转账在系统当中叫业务

100
00:03:56,794 --> 00:04:00,994
那么这个转账的业务是需要很多的对数据库的操作的步骤的

101
00:04:00,994 --> 00:04:05,674
那么这些步骤所构成的对于数据库操作而言所构成的就是什么呢

102
00:04:05,674 --> 00:04:07,034
一个逻辑工作单元

103
00:04:07,034 --> 00:04:10,594
在逻辑工作单元里包含了很多对数据库的操作方式

104
00:04:10,594 --> 00:04:14,074
那我就要保证在这些逻辑单元当中要么执行的都成功

105
00:04:14,074 --> 00:04:16,154
要么执行的要么失败都失败

106
00:04:16,154 --> 00:04:18,874
那么在逻辑单元当中重点控制的是谁呢

107
00:04:18,874 --> 00:04:21,674
就是有DML操作行为的这样的语句

108
00:04:21,674 --> 00:04:22,954
查询无所谓

109
00:04:22,954 --> 00:04:24,914
你怎么查数据都不会发生改变

110
00:04:24,914 --> 00:04:27,514
但是DML操作可是会改变数据的

111
00:04:27,514 --> 00:04:29,594
所以事物要保证它们的一个完整性

112
00:04:29,594 --> 00:04:30,314
要么都成功

113
00:04:30,314 --> 00:04:31,514
要么都失败

114
00:04:31,514 --> 00:04:33,314
对吧同学们

115
00:04:33,314 --> 00:04:37,394
那么我们这个转账其实就是一个不可再分割的工作单元了

116
00:04:37,394 --> 00:04:39,474
例如银行的转账

117
00:04:39,474 --> 00:04:41,914
然后银行这个账户转账业务

118
00:04:41,914 --> 00:04:43,954
还有该业务就是一个巨小的工作单元了

119
00:04:43,954 --> 00:04:46,554
你不能转账里又包含了这个什么其他的子业务

120
00:04:46,554 --> 00:04:48,274
没有这样的转账就是个最小的业务

121
00:04:48,274 --> 00:04:48,634
是不是

122
00:04:48,634 --> 00:04:49,954
那么在一个最小的业务当中

123
00:04:49,954 --> 00:04:51,314
你需要做事物控制的

124
00:04:51,314 --> 00:04:54,154
一个完整的业务需要批量的DML操作

125
00:04:54,154 --> 00:04:54,394
是吧

126
00:04:54,394 --> 00:04:56,914
insert update delete的语句共同联合完成

127
00:04:56,914 --> 00:04:59,474
这是一个事物当中需要包含的

128
00:04:59,474 --> 00:05:02,034
然后事物呢只和DML语句有关

129
00:05:02,034 --> 00:05:03,914
或者说DML语句才有事物

130
00:05:03,914 --> 00:05:05,194
这个和业务逻辑有关

131
00:05:05,194 --> 00:05:06,154
业务逻辑不同

132
00:05:06,154 --> 00:05:07,594
DML语句的个数也不同

133
00:05:07,594 --> 00:05:08,394
明白这些吧

134
00:05:08,394 --> 00:05:09,154
我刚才说了

135
00:05:09,154 --> 00:05:10,754
就拿转账这个业务来看

136
00:05:10,754 --> 00:05:12,234
在这个工作单元当中

137
00:05:12,234 --> 00:05:13,874
一个业务银行转账业务

138
00:05:13,874 --> 00:05:16,394
不就构成了一个对数据库操作的逻辑工作单元吗

139
00:05:16,394 --> 00:05:16,714
是吧

140
00:05:16,714 --> 00:05:17,754
在这个工作单元里

141
00:05:17,754 --> 00:05:19,234
包含了很多的对数据库操作

142
00:05:19,234 --> 00:05:20,394
有查询又有更新

143
00:05:20,394 --> 00:05:22,194
那么事物更多的是控制谁呢

144
00:05:22,194 --> 00:05:26,954
是这个逻辑工作单元当中的更新

145
00:05:26,954 --> 00:05:28,314
或者叫DML操作

146
00:05:28,314 --> 00:05:29,234
明白这些吧

147
00:05:29,234 --> 00:05:32,030
查询是不需要受15控制的

148
00:05:32,030 --> 00:05:33,114
< No Speech >

149
00:05:33,114 --> 00:05:35,834
好,我们再来看一下事物的四大特征

150
00:05:35,834 --> 00:05:38,314
我们也称之为事物的ACID

151
00:05:38,314 --> 00:05:42,114
这个ACID分别就是四大特征单词的首字母

152
00:05:42,114 --> 00:05:44,754
那么我们看一下事物的四大特征有哪四大特征

153
00:05:44,754 --> 00:05:47,314
这四大特征同学们一定要认真地去体会

154
00:05:47,314 --> 00:05:49,554
因为在面试的时候很有可能被问到的

155
00:05:49,554 --> 00:05:50,674
比如说让你回答一下

156
00:05:50,674 --> 00:05:52,954
数据库的事物四大特征

157
00:05:52,954 --> 00:05:55,314
数据库的事物的四大特征有哪些

158
00:05:55,314 --> 00:05:57,874
就ACID有什么,你能说出来

159
00:05:57,874 --> 00:05:59,874
首先第一个A指的就是原子性

160
00:05:59,874 --> 00:06:01,314
那么什么是原子性呢

161
00:06:01,314 --> 00:06:05,594
原子性指的是事物中的操作要么都不做要么全做

162
00:06:06,330 --> 00:06:08,770
是吧,要么都成功,要么都撤销

163
00:06:08,770 --> 00:06:12,170
这就是原子性,事物的第一个特征,具有原子性的特征

164
00:06:12,170 --> 00:06:14,330
第二,一致性,什么呢?

165
00:06:14,330 --> 00:06:18,690
一个事物应该保护所有定义在数据上的不变的属性

166
00:06:18,690 --> 00:06:20,130
例如完整性约束

167
00:06:20,130 --> 00:06:23,770
在完成了一个成功的事物时,数据应该处于一致的状态

168
00:06:23,770 --> 00:06:24,450
这是什么意思?

169
00:06:24,450 --> 00:06:27,490
就是你在完成这一系列操作时

170
00:06:27,490 --> 00:06:30,490
你必须要保证这个业务执行完毕以后

171
00:06:30,490 --> 00:06:34,130
数据库你必须要保证这个业务这个语句执行完毕以后

172
00:06:34,130 --> 00:06:35,410
数据是完全对应的

173
00:06:35,410 --> 00:06:39,570
你不能说完成以后这个数据发现匹配不上了

174
00:06:39,570 --> 00:06:41,450
数据不一致了,那这就不对了

175
00:06:41,450 --> 00:06:45,490
这你事物是就缺失了四大特征其中的一致性的特点

176
00:06:45,490 --> 00:06:47,290
明白这意思吧?

177
00:06:47,290 --> 00:06:48,730
好,我们再来看隔离性

178
00:06:48,730 --> 00:06:49,610
隔离性是什么呢?

179
00:06:49,610 --> 00:06:52,250
是一个事物执行时不能被其他事物所干扰

180
00:06:52,250 --> 00:06:54,530
比如说我们有很多的事物在并发运行时

181
00:06:54,530 --> 00:06:57,930
那我这个事物的运行是不能受另一个事物的干扰的

182
00:06:57,930 --> 00:07:01,170
对吧?因为它们都是一个多线程的这个程序运行

183
00:07:01,170 --> 00:07:02,890
如果受到干扰就会出现问题的

184
00:07:02,890 --> 00:07:04,290
明白这意思吧?

185
00:07:04,290 --> 00:07:06,050
好,还有这个隔离性

186
00:07:06,050 --> 00:07:07,970
持久性,持久性指的是什么呢?

187
00:07:07,970 --> 00:07:09,250
一个事物一旦提交

188
00:07:09,250 --> 00:07:11,570
它对数据库中的数据改变应该是永久性的

189
00:07:11,570 --> 00:07:13,050
也就是说在事物当中

190
00:07:13,050 --> 00:07:14,610
我A给B转账

191
00:07:14,610 --> 00:07:16,690
减200,A减200,B加200

192
00:07:16,690 --> 00:07:19,010
随着我事物执行完毕以后都成功了

193
00:07:19,010 --> 00:07:24,850
那么这个A减200跟B加200这个金额必须要持久化到数据库当中

194
00:07:24,850 --> 00:07:25,890
而且是永久性的

195
00:07:25,890 --> 00:07:27,650
持久化到数据表当中的

196
00:07:27,650 --> 00:07:28,810
而不是临时改变

197
00:07:28,810 --> 00:07:31,010
不是这个放到内存当中的

198
00:07:31,010 --> 00:07:32,770
改变完了就是这样了

199
00:07:32,770 --> 00:07:34,930
不是这个改完之后

200
00:07:34,930 --> 00:07:37,170
可能因为某种情况过一会自己就变了

201
00:07:37,170 --> 00:07:37,890
这是不对的

202
00:07:37,890 --> 00:07:40,050
所以它必须要具备一个持久性的特点

203
00:07:40,050 --> 00:07:41,330
明白这意思吧同学们

204
00:07:41,330 --> 00:07:43,570
必须得更新到数据库表当中的

205
00:07:43,570 --> 00:07:46,370
OK,这是事物的四大特征

206
00:07:46,370 --> 00:07:49,370
那么我们再来看一下事物的类型

207
00:07:49,370 --> 00:07:51,290
在我们这个官型数据库当中

208
00:07:51,290 --> 00:07:53,130
其实它的事物都是有两种的

209
00:07:53,130 --> 00:07:54,330
一种是显示事物

210
00:07:54,330 --> 00:07:55,450
一种是隐私事物

211
00:07:55,450 --> 00:07:57,050
什么是显示事物呢?

212
00:07:57,050 --> 00:07:58,610
所谓的显示事物指的就是

213
00:07:58,610 --> 00:08:00,770
需要我们手动的提交或回轨

214
00:08:00,770 --> 00:08:01,930
DML语句当中

215
00:08:01,930 --> 00:08:04,130
所有的操作都是显示事物执行

216
00:08:04,130 --> 00:08:05,930
都是显示事物操作

217
00:08:05,930 --> 00:08:09,890
也就是说我们其实是需要对DML语句

218
00:08:09,890 --> 00:08:12,094
做事物的控制的

219
00:08:12,858 --> 00:08:19,218
还有就是反过来说DML语句是可以让我们去手动控制的

220
00:08:19,218 --> 00:08:21,618
或者叫手动的做事物操作的控制的

221
00:08:21,618 --> 00:08:23,378
明白这意思吧

222
00:08:23,378 --> 00:08:24,578
这些是显示事物

223
00:08:24,578 --> 00:08:28,178
我们需要自己去人为的手动操作事物

224
00:08:28,178 --> 00:08:29,938
对它进行提交或回滚

225
00:08:29,938 --> 00:08:31,178
提交指的就是确认

226
00:08:31,178 --> 00:08:32,378
回滚指的就是撤销

227
00:08:32,378 --> 00:08:34,058
这样的都是显示事物

228
00:08:34,058 --> 00:08:35,778
那什么是隐私事物呢

229
00:08:35,778 --> 00:08:37,898
隐私事物指的是数据库自动提交

230
00:08:37,898 --> 00:08:39,098
不需要我们做任何处理

231
00:08:39,098 --> 00:08:40,978
同时也不具备回滚性的

232
00:08:40,978 --> 00:08:44,698
比如说DDL DCL这些语言都是事物操作

233
00:08:44,698 --> 00:08:45,778
隐私事物操作

234
00:08:45,778 --> 00:08:47,338
我们还记得DDL

235
00:08:47,338 --> 00:08:48,178
Create table

236
00:08:48,178 --> 00:08:50,298
Create database

237
00:08:50,298 --> 00:08:50,698
是吧

238
00:08:50,698 --> 00:08:52,018
Create index

239
00:08:52,018 --> 00:08:53,018
我们都讲过

240
00:08:53,018 --> 00:08:55,498
那么这些语句它都是隐私事物

241
00:08:55,498 --> 00:08:57,618
我们不能对它做事物控制的

242
00:08:57,618 --> 00:08:59,178
数据库会自动的就提交了

243
00:08:59,178 --> 00:09:00,138
它不能做回滚

244
00:09:00,138 --> 00:09:01,458
也就是说你创建表就创建了

245
00:09:01,458 --> 00:09:03,618
你不能创建一半说我撤销

246
00:09:03,618 --> 00:09:05,178
我对创建的表再做撤销

247
00:09:05,178 --> 00:09:06,138
这是撤不了的

248
00:09:06,618 --> 00:09:07,818
所以它是隐私事物

249
00:09:07,818 --> 00:09:10,218
那么我们现在所最关心的是谁呢

250
00:09:10,218 --> 00:09:11,658
就是显示事物

251
00:09:11,658 --> 00:09:14,178
我们未来怎么在DML语句当中

252
00:09:14,178 --> 00:09:16,938
我们怎么通过事物去控制DML语句

253
00:09:16,938 --> 00:09:18,098
这是我们所关心的

254
00:09:18,098 --> 00:09:19,778
隐私事物是数据库管理的

255
00:09:19,778 --> 00:09:20,698
我们就不要管它了

256
00:09:20,698 --> 00:09:21,338
明白这一次吧

257
00:09:21,338 --> 00:09:22,338
好

258
00:09:22,338 --> 00:09:24,538
我们再来看一下这节课的实时效果反馈

259
00:09:24,538 --> 00:09:28,618
如下描述事物四大特征正确的是

260
00:09:28,618 --> 00:09:29,898
A 原子性

261
00:09:29,898 --> 00:09:32,298
可读性 隔离性 持久性

262
00:09:32,298 --> 00:09:35,418
B 可读性 移植性 隔离性 持久性

263
00:09:35,418 --> 00:09:38,698
C 可读性 移植性 可写性 持久性

264
00:09:38,698 --> 00:09:41,778
D 原子性 移植性 隔离性 持久性

265
00:09:41,778 --> 00:09:43,298
那么大家想一下

266
00:09:43,298 --> 00:09:44,798
最要紧的答案是什么呢

267
00:09:45,402 --> 00:09:49,802
很显然是D,作为一个事物你必须要具备ACID

268
00:09:49,802 --> 00:09:53,402
ACID是什么?是原子性、一致性、隔离性和持久性

269
00:09:53,402 --> 00:09:57,402
对吧同学们,所以说这个标准答案是D

270
00:09:57,402 --> 00:10:01,482
好同学们,那么这节课我们主要是先来了解一下什么是事物

271
00:10:01,482 --> 00:10:03,482
好,那我们这节课就到这

