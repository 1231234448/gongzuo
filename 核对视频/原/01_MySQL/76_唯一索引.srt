1
00:00:00,890 --> 00:00:05,170
上节课我们讲解了MySQL锁引中的普通锁引

2
00:00:05,170 --> 00:00:09,650
那么这个普通锁引我们在平时创建锁引时用的还是比较多的

3
00:00:09,650 --> 00:00:15,210
那么这节课我们再来讲解一下MySQL锁引中的唯一锁引

4
00:00:15,210 --> 00:00:17,130
那么什么是唯一锁引呢?

5
00:00:17,130 --> 00:00:21,450
唯一锁引与普通锁引基本上是相似的

6
00:00:21,450 --> 00:00:24,010
但是有一点不同,不同的是什么呢?

7
00:00:24,010 --> 00:00:28,530
唯一锁引的列,就是这个锁引的列的值必须是唯一的

8
00:00:28,530 --> 00:00:32,450
而普通锁引不会要求你这个列的值是必须唯一的

9
00:00:32,450 --> 00:00:33,610
明白这些吧?

10
00:00:33,610 --> 00:00:37,290
那么唯一锁引就是要求你这个列的值必须是唯一的

11
00:00:37,290 --> 00:00:40,210
但是允许有空,这一点跟普通锁引列是一样的

12
00:00:40,210 --> 00:00:43,690
普通锁引这个列也是允许有空值的,明白这些吧?

13
00:00:43,690 --> 00:00:46,450
那么其实你看它的唯一锁引的特征

14
00:00:46,450 --> 00:00:50,290
是不是跟我们之前所讲过的V1型约束比较相似啊?

15
00:00:50,290 --> 00:00:54,610
我们在讲MySQL约束的时候,我们是不是讲过一个V1型约束?

16
00:00:54,610 --> 00:00:58,130
对吧?那么V1型约束的特点就是这个列可以有值

17
00:00:58,130 --> 00:01:00,010
但是这个值不能有重复的

18
00:01:00,010 --> 00:01:04,010
但是可以有空,有多个空,没值是可以的

19
00:01:04,010 --> 00:01:05,290
明白这些吧?

20
00:01:05,290 --> 00:01:11,530
那么其实当我们在为表当中的某一个列分配了V1型约束时

21
00:01:11,530 --> 00:01:15,290
那么这个列就已经自带了V1型锁引了

22
00:01:15,290 --> 00:01:17,490
就跟我们之前所看到的

23
00:01:17,490 --> 00:01:24,610
当你为某个表的主件,对某个表的某个列分配了主件约束

24
00:01:24,610 --> 00:01:29,290
那么这个列就已经自动具备了主件锁引了

25
00:01:29,290 --> 00:01:30,290
明白这些吧?

26
00:01:30,290 --> 00:01:32,530
那我们来看一下是不是这样的

27
00:01:32,530 --> 00:01:34,650
我们看这里有一个EMP表

28
00:01:34,650 --> 00:01:37,210
这是我们之前北京商业堂这个库里所包含的表

29
00:01:37,210 --> 00:01:38,690
有个EMP表

30
00:01:38,690 --> 00:01:45,050
EMP表里,DPTS这个表

31
00:01:45,050 --> 00:01:49,330
在这个表当中,它有一个Department Name

32
00:01:49,330 --> 00:01:50,210
看到了吗?

33
00:01:50,210 --> 00:01:53,050
然后这里有一个Unique Key

34
00:01:53,050 --> 00:01:55,050
Unique Key不V1型约束吗?

35
00:01:55,050 --> 00:01:58,170
然后给谁建立了V型约束呢?

36
00:01:58,170 --> 00:02:00,210
是不是Department Name这个表

37
00:02:00,210 --> 00:02:06,450
那说明DPTS这个表里的Department Name就已经具备了V型约束了

38
00:02:06,450 --> 00:02:12,690
那么其实这个表当中已经拥有一个V1锁引了

39
00:02:12,690 --> 00:02:14,250
谁呢?就是Department Name

40
00:02:14,250 --> 00:02:15,998
我们看看是不是这样的

41
00:02:15,998 --> 00:02:18,522
< No Speech >

42
00:02:18,522 --> 00:02:25,722
我们来查一下,show index from dpts这个表,对吧

43
00:02:25,722 --> 00:02:28,122
运行,看到了吗同学们

44
00:02:28,122 --> 00:02:30,122
我们往下拽一下啊

45
00:02:30,122 --> 00:02:32,922
看,这里是不是有两个说音呢

46
00:02:32,922 --> 00:02:35,722
一个是primary,就是组件说音,是吧

47
00:02:35,722 --> 00:02:38,202
还有一个叫department name的

48
00:02:38,202 --> 00:02:40,322
然后column呢就是department name

49
00:02:40,322 --> 00:02:41,922
这就是那个唯一说音

50
00:02:41,922 --> 00:02:43,802
然后呢这里是允许有空值的

51
00:02:43,802 --> 00:02:45,762
我们唯一说你是允许有空值的,是吧

52
00:02:45,762 --> 00:02:48,202
但是如果你有值,这个值是不能有重复的

53
00:02:48,202 --> 00:02:49,802
知道了吧同学们

54
00:02:49,802 --> 00:02:53,122
也就是当我们为某个列分配了唯一性约束

55
00:02:53,122 --> 00:02:56,522
那么这个列则自带唯一性说音

56
00:02:56,522 --> 00:03:01,522
那么我们能不能再给那些不具备唯一性约束的

57
00:03:01,522 --> 00:03:03,522
这样的列添加唯一说音呢

58
00:03:03,522 --> 00:03:04,922
答案肯定是可以的呀

59
00:03:04,922 --> 00:03:06,522
那么怎么添加呢

60
00:03:06,522 --> 00:03:09,722
它的这个创建唯一说音的语句

61
00:03:09,722 --> 00:03:11,802
它的语句是create

62
00:03:11,802 --> 00:03:13,602
然后注意不是index了

63
00:03:13,602 --> 00:03:15,922
是uniqueindex,唯一说音

64
00:03:15,922 --> 00:03:19,202
然后说音的名字,表明,然后括号列明

65
00:03:19,202 --> 00:03:20,922
我们来看一个实例

66
00:03:20,922 --> 00:03:25,762
实例要求为emp表当中的name创建唯一说音

67
00:03:25,762 --> 00:03:28,162
说音名为emp-name-index

68
00:03:28,162 --> 00:03:30,302
好,我们来创建一个啊

69
00:03:30,302 --> 00:03:31,386
< No Speech >

70
00:03:31,386 --> 00:03:34,506
在这里把它放下来

71
00:03:34,506 --> 00:03:35,706
一会我们会用到

72
00:03:35,706 --> 00:03:37,746
这里改成emp

73
00:03:37,746 --> 00:03:39,506
我们先看一下emp表

74
00:03:39,506 --> 00:03:41,866
现在emp表里有什么缩影

75
00:03:41,866 --> 00:03:43,146
什么缩影都没有

76
00:03:43,146 --> 00:03:43,826
对吧

77
00:03:43,826 --> 00:03:46,786
那我们现在要去创建一个唯一缩影

78
00:03:46,786 --> 00:03:48,146
那就是create

79
00:03:48,146 --> 00:03:49,826
注意不是index了

80
00:03:49,826 --> 00:03:52,670
是unique index

81
00:03:52,670 --> 00:03:53,818
< No Speech >

82
00:03:53,818 --> 00:03:54,378
对吧

83
00:03:54,378 --> 00:04:00,218
然后索引的名字叫emp下滑械name下滑械index

84
00:04:00,218 --> 00:04:04,258
然后表明为哪个表创建的emp

85
00:04:04,258 --> 00:04:05,698
emp表的哪个列呢

86
00:04:05,698 --> 00:04:06,738
name这个列

87
00:04:07,338 --> 00:04:07,898
对吧

88
00:04:07,898 --> 00:04:08,138
好

89
00:04:08,138 --> 00:04:10,138
我们选中运行

90
00:04:10,498 --> 00:04:10,738
好

91
00:04:10,738 --> 00:04:12,178
我们看现在有一个tool是吧

92
00:04:12,178 --> 00:04:13,018
他说什么呢

93
00:04:13,058 --> 00:04:18,018
说在这个索引列当中有重复值出现了

94
00:04:18,578 --> 00:04:19,098
是吧

95
00:04:19,138 --> 00:04:19,938
有复制的

96
00:04:19,938 --> 00:04:20,898
说复制就是重复

97
00:04:20,898 --> 00:04:22,338
有重复的key出现了

98
00:04:22,338 --> 00:04:26,018
难道是我索引名字相同了吗

99
00:04:26,018 --> 00:04:26,538
不是的

100
00:04:26,538 --> 00:04:26,938
同学们

101
00:04:26,938 --> 00:04:28,658
出遇到这个问题

102
00:04:28,658 --> 00:04:29,978
你看是哪块出现问题了

103
00:04:29,978 --> 00:04:31,458
这是教你们解决问题的一个方式

104
00:04:31,458 --> 00:04:33,858
为什么我创建微信索引的时候

105
00:04:33,858 --> 00:04:35,138
下面会有表示

106
00:04:35,138 --> 00:04:36,938
会告诉我有重复键出现的

107
00:04:37,178 --> 00:04:39,578
不是你索引的名字有重复了

108
00:04:39,578 --> 00:04:41,058
而是在你数据

109
00:04:41,058 --> 00:04:43,018
在你表当中有重复数据了

110
00:04:43,058 --> 00:04:44,538
我们看看是不是这样的

111
00:04:44,538 --> 00:04:47,070
当然了正话说bl рас解决的总共有750 000 00 000的 bikes

112
00:04:47,070 --> 00:04:48,986
< No Speech >

113
00:04:48,986 --> 00:04:50,666
哪个字段?Name

114
00:04:50,666 --> 00:04:52,090
< No Speech >

115
00:04:52,090 --> 00:04:54,910
看看这不AA吗 告诉你很清楚了吗

116
00:04:54,910 --> 00:04:57,498
< No Speech >

117
00:04:57,498 --> 00:05:02,058
是吧 有重复了 那我们现在看没看到这个A啊 看到了

118
00:05:02,058 --> 00:05:06,018
所以说当你在创建V1所引的时候 如果这个表里有数据

119
00:05:06,018 --> 00:05:11,258
且这个表当中数据有重复的时候 你是不能为这个列创建V1所引的

120
00:05:11,258 --> 00:05:15,618
明白了吗 同学们 你在创建V1所引时必须要保证

121
00:05:15,618 --> 00:05:19,070
这个列的数据是没有重复的

122
00:05:19,070 --> 00:05:20,154
< No Speech >

123
00:05:20,154 --> 00:05:22,154
那我们现在怎么办呢?把它删掉

124
00:05:22,154 --> 00:05:24,374
是吧,Ratio控制是没有问题的

125
00:05:24,374 --> 00:05:25,414
现在就没有重复了

126
00:05:25,414 --> 00:05:27,230
好,我们再来创建

127
00:05:27,230 --> 00:05:29,370
< No Speech >

128
00:05:29,370 --> 00:05:30,942
理四还有重复的

129
00:05:30,942 --> 00:05:33,690
< No Speech >

130
00:05:33,690 --> 00:05:35,690
在这里,李四还真有重复的啊

131
00:05:35,690 --> 00:05:40,378
< No Speech >

132
00:05:40,378 --> 00:05:41,578
我们再来创建

133
00:05:41,578 --> 00:05:43,098
< No Speech >

134
00:05:43,098 --> 00:05:45,778
这个索引创建成功了

135
00:05:45,778 --> 00:05:49,378
所以同学们我们创建索引或者是做数据库操作时

136
00:05:49,378 --> 00:05:50,978
如果有错误了不要着急

137
00:05:50,978 --> 00:05:54,018
看看下面的错误然后去解决错误就可以了

138
00:05:54,018 --> 00:05:57,178
所以刚才那个问题是因为你表里有重复数据了

139
00:05:57,178 --> 00:06:00,498
导致唯一索引创建失败

140
00:06:00,498 --> 00:06:02,098
好我们运行

141
00:06:02,098 --> 00:06:03,418
看到了吧

142
00:06:03,418 --> 00:06:05,458
现在是不是有一个唯一索引了

143
00:06:05,458 --> 00:06:07,458
OK这是创建唯一索引

144
00:06:07,458 --> 00:06:11,818
那么我们也可以修改表来添加唯一索引

145
00:06:11,818 --> 00:06:13,498
那么它的语句是什么呢

146
00:06:13,498 --> 00:06:18,058
它的语句是alter table表名add unique

147
00:06:18,058 --> 00:06:21,138
然后索引名字括号然后列名

148
00:06:21,138 --> 00:06:22,538
如果有长读给长读

149
00:06:22,538 --> 00:06:24,218
我们来看一个事例

150
00:06:24,218 --> 00:06:27,738
修改emp表为celery列添加唯一索引

151
00:06:27,738 --> 00:06:31,618
索引名为emp下滑线celery index

152
00:06:31,618 --> 00:06:34,618
现在让你采用修改emp表的方式来添加索引

153
00:06:34,618 --> 00:06:35,138
对吧

154
00:06:35,138 --> 00:06:36,738
好我们来写一个

155
00:06:36,738 --> 00:06:40,098
那就是alter table

156
00:06:40,098 --> 00:06:40,778
对吧

157
00:06:40,778 --> 00:06:41,938
然后哪个表呢

158
00:06:41,938 --> 00:06:43,658
emp这个表干嘛呢

159
00:06:43,658 --> 00:06:46,658
添加一个unique

160
00:06:46,658 --> 00:06:48,458
unique

161
00:06:48,458 --> 00:06:49,418
索引对吧

162
00:06:49,418 --> 00:06:51,098
注意后面就不要加index了

163
00:06:51,098 --> 00:06:52,338
直接unique就可以了

164
00:06:52,338 --> 00:06:53,778
然后所以那名字叫什么呢

165
00:06:53,778 --> 00:06:57,938
emp下滑线celery下滑线index

166
00:06:57,938 --> 00:06:58,378
括号

167
00:06:58,378 --> 00:06:59,338
然后这里给谁呢

168
00:06:59,338 --> 00:07:01,858
给列名celery

169
00:07:01,858 --> 00:07:03,258
对吧同学们

170
00:07:03,258 --> 00:07:04,618
哎这样就可以了

171
00:07:04,618 --> 00:07:06,458
然后我们运行

172
00:07:06,458 --> 00:07:09,538
你看这里又有重复数据了吧

173
00:07:09,538 --> 00:07:10,458
是吧

174
00:07:10,458 --> 00:07:12,938
2000这个数据重复了

175
00:07:12,938 --> 00:07:13,938
我们看一下

176
00:07:13,938 --> 00:07:15,138
还真是

177
00:07:15,138 --> 00:07:17,950
那我们现在把所有的数据都删除掉吧

178
00:07:17,950 --> 00:07:21,946
< No Speech >

179
00:07:21,946 --> 00:07:23,346
好 我们再来运行

180
00:07:24,146 --> 00:07:25,746
是吧 锁引创建成功了

181
00:07:25,746 --> 00:07:27,346
然后我们再去查看锁引

182
00:07:27,746 --> 00:07:28,746
看到了吗 同学们

183
00:07:28,746 --> 00:07:30,146
现在有两个锁引了

184
00:07:30,146 --> 00:07:32,146
两个唯一锁引了

185
00:07:32,146 --> 00:07:33,822
好 我们再来看

186
00:07:33,822 --> 00:07:35,002
< No Speech >

187
00:07:35,002 --> 00:07:38,042
之前呢现在呢我们讲的是修改表是吧

188
00:07:38,042 --> 00:07:41,802
那其实我们在创建表的时候呢也可以指定唯一性缩影

189
00:07:41,802 --> 00:07:43,762
比如说用Create一句创建表

190
00:07:43,762 --> 00:07:48,242
在后面用一个这个unique然后缩影名字就可以了

191
00:07:48,242 --> 00:07:50,362
明白吧创建表是指定缩影

192
00:07:50,362 --> 00:07:51,642
我们来看一个实例

193
00:07:51,642 --> 00:07:56,162
要求我们创建emp5这个表包含empid name of address

194
00:07:56,162 --> 00:08:02,002
同时为name列创建唯一缩影名为emp5下方写name index

195
00:08:02,002 --> 00:08:04,002
好我们来创建一个

196
00:08:04,002 --> 00:08:06,002
好我们在下方写

197
00:08:06,002 --> 00:08:09,402
首先呢是一个建表语句那就是create

198
00:08:10,362 --> 00:08:17,642
然后表明emp5 这里要求有什么呢

199
00:08:17,642 --> 00:08:19,002
< No Speech >

200
00:08:19,002 --> 00:08:25,522
有emp下发线ID,int类型的,然后是个主键,primary key

201
00:08:25,522 --> 00:08:28,202
然后我们就不给它什么自动增长了,都无所谓

202
00:08:28,202 --> 00:08:29,922
就是auto-increment的问题

203
00:08:29,922 --> 00:08:31,922
然后name,YX

204
00:08:31,922 --> 00:08:33,274
< No Speech >

205
00:08:33,274 --> 00:08:35,034
长度30

206
00:08:35,034 --> 00:08:38,034
然后继续加 还有一个address列是吧

207
00:08:38,034 --> 00:08:43,834
< No Speech >

208
00:08:43,834 --> 00:08:45,834
我的JAZZ,然后呢,Y-TAR

209
00:08:45,834 --> 00:08:47,482
< No Speech >

210
00:08:47,482 --> 00:08:48,798
呃 30

211
00:08:48,798 --> 00:08:51,674
< No Speech >

212
00:08:51,674 --> 00:08:54,874
它加完了,接下来我们就要指定唯一输引了

213
00:08:54,874 --> 00:08:57,514
那就是unique

214
00:08:57,514 --> 00:09:00,114
然后输引名字emp5

215
00:09:00,114 --> 00:09:01,834
下滑线name

216
00:09:01,834 --> 00:09:04,514
下滑线index

217
00:09:04,514 --> 00:09:08,702
然后这里以谁作为这个输引链呢?以name这个链

218
00:09:09,338 --> 00:09:14,338
明白了同学们,这样这个箭标语句我们就搞定了,我们来执行一下

219
00:09:14,338 --> 00:09:16,090
< No Speech >

220
00:09:16,090 --> 00:09:17,690
看到了吗?表创建出来了

221
00:09:17,690 --> 00:09:19,090
然后我们再去

222
00:09:19,090 --> 00:09:23,358
show index from emp5

223
00:09:24,218 --> 00:09:30,578
这里有两个缩影,一个是主件缩影,一个是唯一缩影

224
00:09:30,578 --> 00:09:33,258
这是创建表示来指定唯一缩影

225
00:09:33,258 --> 00:09:36,058
我们来看一下这节课的实时效果反馈

226
00:09:36,058 --> 00:09:40,218
唯一所引列的值什么逗号什么有空值

227
00:09:40,218 --> 00:09:46,138
A,允许不唯一,也就是说唯一所引列的值是允许不唯一的

228
00:09:46,138 --> 00:09:47,578
然后允许有空值

229
00:09:47,578 --> 00:09:52,138
B,所引列的值是必须唯一,然后允许有空值

230
00:09:52,138 --> 00:09:57,738
C,唯一所引列的值必须唯一,然后不允许有空值

231
00:09:57,738 --> 00:10:03,178
D,唯一所引列的值允许不唯一,不允许有空值

232
00:10:03,178 --> 00:10:05,310
那么这道题的答案是哪个呢?

233
00:10:06,266 --> 00:10:12,346
很显然是B嘛 必须为一 水眼内的值必须是为一 但是允许有空值的 是吧

234
00:10:12,346 --> 00:10:14,302
好 我们再来看第二题

235
00:10:14,874 --> 00:10:19,874
创建唯一所有的语句是create什么indexName on table

236
00:10:19,874 --> 00:10:21,694
列名然后长度

237
00:10:21,694 --> 00:10:24,858
< No Speech >

238
00:10:24,858 --> 00:10:26,138
看一下关键字啊

239
00:10:26,658 --> 00:10:31,778
A unique B index C unique index

240
00:10:31,778 --> 00:10:34,258
符数s的D unique index

241
00:10:34,258 --> 00:10:35,138
应该是哪个

242
00:10:35,338 --> 00:10:36,178
是不是D啊

243
00:10:36,218 --> 00:10:36,538
是吧

244
00:10:36,538 --> 00:10:39,458
直接创建缩影是Creator后面创建的唯一缩影

245
00:10:39,498 --> 00:10:41,418
它的关键字是unique index

246
00:10:41,458 --> 00:10:42,338
单数形式

247
00:10:42,378 --> 00:10:42,658
对吧

248
00:10:42,658 --> 00:10:43,018
同学们

249
00:10:43,018 --> 00:10:45,378
所以这个题的答案是D

250
00:10:45,378 --> 00:10:46,818
1是B

251
00:10:46,818 --> 00:10:47,378
2是D

252
00:10:47,378 --> 00:10:48,098
没有问题

253
00:10:48,098 --> 00:10:48,458
好

254
00:10:48,458 --> 00:10:48,818
同学们

255
00:10:48,818 --> 00:10:49,498
那么以上呢

256
00:10:49,498 --> 00:10:53,138
我们就讲解了如何去创建唯一缩影

257
00:10:53,138 --> 00:10:53,458
好

258
00:10:53,458 --> 00:10:55,258
那我们这节课呢就到这

